<html>
<head>
	<title>threejs-basic</title>

	<style>
		body{
			margin: 0;
			overflow: hidden;
		}

	</style>
</head>
<body>

	<script src="js/three.js"></script>
	<script src="js/OrbitControls.js"></script>
	<script src="js/loaders/DRACOLoader.js"></script>
	<script src="js/loaders/GLTFLoader.js"></script>
	<script src="js/controls/TransformControls.js"></script>

	<script>
		var renderer = new THREE.WebGLRenderer({antialias: true});
		
		//renderer.setClearColor(0x00ff00);
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);

		document.body.appendChild(renderer.domElement);

		var scene = new THREE.Scene();
		scene.background = new THREE.Color(0xffffff);
		/*scene.background = new THREE.CubeTextureLoader()
			.setPath( 'cube/skyboxsun25deg/' )
			.load( [ 'px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg' ] );*/

		var camera = new THREE.PerspectiveCamera(35/*视角*/, window.innerWidth / window.innerHeight, 0.1, 100000);
		
		camera.position.set(1000,2000,1000);
		camera.lookAt(new THREE.Vector3(0,0,0));
		
		//坐标轴
		var axesHelper = new THREE.AxesHelper(500);//X-red, Y-green, Z-blue.
		scene.add(axesHelper);

		var controls = new THREE.OrbitControls(camera, renderer.domElement);
		controls.update();

		var light = new THREE.AmbientLight(0xffffff, 0.5);
		//light.position.set(10000,20000,10000);
		//scene.add(light);
		var light1 = new THREE.PointLight(0xffffff, 1);
		//scene.add(light1);
		var dirlight = new THREE.DirectionalLight(0xffffff,1);
		dirlight.position.set(1000,2000,1000);
		dirlight.castShadow = true;
		scene.add(dirlight);


		var MAX_POINTS = 500;

		var geometry = new THREE.CubeGeometry(100,150,100);
		var geometry2 = new THREE.BoxBufferGeometry(100,300,100);

		//geometry2.addAttribute('position', new THREE.BufferAttribute(positions,3));

		var material = new THREE.MeshLambertMaterial({color: 0xFFFFFF, wireframe: false});
		var mesh = new THREE.Mesh(geometry,material);
		var mesh1 = new THREE.Mesh(geometry2,material);
		var mesh2 = new THREE.Mesh(geometry,material);
		var mesh3 = new THREE.Mesh(geometry, material);
		mesh.position.set(0,75,-100);
		mesh1.position.set(300,150,-300);
		mesh2.position.set(-300,75,-300);
		mesh3.position.set(150,75,200);

		//moveable
		

		//scene.add(mesh);
		//scene.add(mesh1);
		//scene.add(mesh2);
		//scene.add(mesh3);

		//building
		THREE.DRACOLoader.setDecoderPath( '/js/libs/draco' );
		var loader = new THREE.GLTFLoader();
		loader.setDRACOLoader(new THREE.DRACOLoader());

		loader.load(
			'models/cenario_urbano/scene.gltf',
			function(gltf){
				city = gltf.scene;

				city.position.set(0,0,0);
				city.scale.set(15,15,15);
				
				scene.add(city);
			},
			function(xhr){
				console.log((xhr.loaded/xhr.total *100)+'% loaded');
			},
			function(error){
				console.log('An error happened');
			}
		);
		loader.load(
			'models/toyota_ae86/scene.gltf',
			function(gltf){
				ae86 = gltf.scene;

				ae86.position.set(-10,0,0);
				ae86.scale.set(40,40,20);
				
				scene.add(ae86);
			},
			function(xhr){
				console.log((xhr.loaded/xhr.total *100)+'% loaded');
			},
			function(error){
				console.log('An error happened');
			}
		);

		
		function updateZ() {
			ae86.position.z += 1;
			ae86.rotation.y += 0.1;
		//	yourobjcet.position.x+=somevaluex;
//yourobjcet.position.y+=somevaluey;
//yourobjcet.position.z+=somevaluez;
		}

		document.onkeydown = function(event) {
			c = String.fromCharCode(event.keyCode);
			c = c.toLowerCase(c);
			if (c == 'w')
			ae86.position.z += 5;
			else if (c == 's')
			ae86.position.z -= 5;
			else if (c == 'a')
			ae86.position.x += 5;
			else if (c == 'd') 
			ae86.position.x -= 5;
			else if (c == 'q')
				ae86.rotation.y += Math.PI/4;
			else if (c == 'e')
				ae86.rotation.y -= 0.1;
		}

	//	setInterval(update, 1000/60);


		loader.load(
			'models/a_pile_of_clay/scene.gltf',
			function(gltf){
				clay = gltf.scene;

				clay.position.set(-100,30,-900);
				clay.scale.set(5,5,5);
				//scene.add(clay);
				//controls = new THREE.TransformControls(camera, renderer.domElement);
				//controls.attach(clay);
				//scene.add(controls);
				
			},
			function(xhr){
				console.log((xhr.loaded/xhr.total *100)+'% loaded');
			},
			function(error){
				console.log('An error happened');
			}
		);





		//floor
		var floorMat = new THREE.MeshStandardMaterial({
			roughness: 0.8,
			color: 0xffffff,
			metalness: 0.2, bumpScale: 0.0005
		})
		
		var Floor = new THREE.Mesh(
			new THREE.PlaneGeometry(10000,10000,100,100),
			//floorMat);
			new THREE.MeshBasicMaterial({color:0x000000, wireframe:true})
			);
		Floor.rotation.x += Math.PI/2;
		scene.add(Floor);
	
		requestAnimationFrame(render);
		function render(){
			requestAnimationFrame(render);

			//scene.rotation.y += 0.01;
			//camera.rotation.z += 0.01;
			//mesh1.rotation.y += 0.01;
			controls.update();
			renderer.render(scene,camera);
		}

		//renderer.render(scene,camera);
		//document.body.appendChild(renderer.domElement);
	</script>
</body>
</html>
